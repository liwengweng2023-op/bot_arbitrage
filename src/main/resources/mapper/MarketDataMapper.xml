<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="co.codingnomads.bot.arbitrage.mapper.MarketDataMapper">
    
    <resultMap id="MarketDataResultMap" type="co.codingnomads.bot.arbitrage.model.MarketData">
        <id column="id" property="id"/>
        <result column="exchange" property="exchange"/>
        <result column="symbol" property="symbol"/>
        <result column="bid_price" property="bidPrice"/>
        <result column="ask_price" property="askPrice"/>
        <result column="bid_volume" property="bidVolume"/>
        <result column="ask_volume" property="askVolume"/>
        <result column="timestamp" property="timestamp"/>
        <result column="created_at" property="createdAt"/>
    </resultMap>

    <!-- 插入行情数据 -->
    <insert id="insertMarketData" parameterType="co.codingnomads.bot.arbitrage.model.MarketData" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO market_data (exchange, symbol, bid_price, ask_price, bid_volume, ask_volume, timestamp, created_at)
        VALUES (#{exchange}, #{symbol}, #{bidPrice}, #{askPrice}, #{bidVolume}, #{askVolume}, #{timestamp}, #{createdAt})
    </insert>

    <!-- 获取最新的行情数据 -->
    <select id="getLatestMarketData" resultMap="MarketDataResultMap">
        SELECT * FROM market_data
        <where>
            <if test="exchange != null and exchange != ''">
                AND exchange = #{exchange}
            </if>
            <if test="symbol != null and symbol != ''">
                AND symbol = #{symbol}
            </if>
        </where>
        ORDER BY timestamp DESC
        <if test="limit > 0">
            LIMIT #{limit}
        </if>
    </select>

    <!-- 获取今日数据统计 -->
    <select id="getTodayDataCount" resultType="int">
        SELECT COUNT(*) FROM market_data
        WHERE DATE(created_at) = CURDATE()
        <if test="exchange != null and exchange != ''">
            AND exchange = #{exchange}
        </if>
    </select>

</mapper>
